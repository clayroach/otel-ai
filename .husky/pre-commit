echo "üîç Running pre-commit checks..."

# Format all code
echo "üìù Formatting code..."
pnpm format

# Run type checking for all packages
echo "üîç Running TypeScript type checking..."
if ! pnpm typecheck:all; then
    echo ""
    echo "‚ö†Ô∏è  TypeScript or ESLint errors detected!"
    echo ""
    echo "ü§ñ The Effect-TS Optimization Agent can help fix these issues."
    echo "   This agent will:"
    echo "   ‚Ä¢ Eliminate 'as any' usage and type assertions"
    echo "   ‚Ä¢ Fix Effect-TS anti-patterns (Effect.gen misuse, Effect.Adaptor)"
    echo "   ‚Ä¢ Ensure proper layer composition and dependency injection"
    echo "   ‚Ä¢ Apply TypeScript best practices and null safety"
    echo ""
    echo "To run the optimization agent, use Claude Code with:"
    echo ""
    echo "  'Use the effect-ts-optimization-agent to fix the TypeScript and linting errors'"
    echo ""
    echo "Or commit with --no-verify to bypass these checks (not recommended):"
    echo ""
    echo "  git commit --no-verify -m \"your message\""
    echo ""
    exit 1
fi

echo "‚úÖ Pre-commit checks passed!"